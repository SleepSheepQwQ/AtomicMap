name: Project Guard

on: [push, workflow_dispatch]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: 检查配置逻辑
        run: |
          # 确保根目录有仓库定义，否则直接拦截
          grep -q "google()" build.gradle.kts || (echo "错误：缺少仓库定义" && exit 1)
          
      - name: 检查 MainActivity 语法死穴
        run: |
          # 检查是否还在 onDestroy 里引用未定义的 args
          if grep -q "unbindUserService(args" app/src/main/kotlin/com/atomic/map/MainActivity.kt; then
             if ! grep -q "val args =" app/src/main/kotlin/com/atomic/map/MainActivity.kt; then
                echo "致命错误：MainActivity 引用了未定义的变量 args！"
                exit 1
             fi
          fi
